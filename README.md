# Wandering IoT

[![Build Status](https://travis-ci.org/devstopfix/iot-wander.svg?branch=master)](https://travis-ci.org/devstopfix/iot-wander)

A web service for the reliable consumption of large volumes of [time series](https://en.wikipedia.org/wiki/Time_series) data generated by [IoT](https://en.wikipedia.org/wiki/Internet_of_Things) devices.

## Rationale

My first Elixir project! An experiment building an IoT solution using [Elixir](http://elixir-lang.org/), the [Actor model](https://en.wikipedia.org/wiki/Actor_model), and the [Erlang](http://www.erlang.org) VM.

## Goals

* Learn Elixir
* Plot how many actors can run in a single VM against throughput rates

# Project

## Install Elixir on OS X

Using [Homebrew](http://brew.sh):

    brew update
    brew install elixir

## Build

To build an Elixir project:

    mix deps.get
    mix compile

## Test

To run the tests:

    mix test

To run a single test at line 10:

    mix test test/wander/api/api_test.exs:10

## Run

To run a local API:

    mix run --no-halt

To test the API:

    curl -v http://localhost:4000/

To close the program:

    [ctrl]-[c]
    a (abort)

## Dev

To start an interactive shell and run the web server:

    iex -S mix

Start some Hubs and send them a message:

    Hub.Supervisor.start_link
    Hub.Supervisor.start_hub("5B:00:00:00:00:01")
    Hub.Supervisor.start_hub("5B:00:00:00:00:02")

    Hub.Server.publish("5B:00:00:00:00:01", "")

Find a Hub via `gproc`:

    :gproc.where({:n, :l, {:hub, "5B:00:00:00:00:01"}})

    #PID<0.290.0>

## Quality

Code style linter:

    mix dogma

## Documentation

See this [README](README.md) and the [docs](doc/index.html).

To generate the HTML documentation from the source code:

    mix docs
    open doc/index.html

# API

The web service provides a RESTful API over HTTPS. 

## Resources

The API provides this resource:

* `/hub/{MAC}` - the endpoint to which a HUB can POST it's data

## Data types

`MAC` addresses are currently only 48-bit mac addresses, represented as 6 hexadecimal words in uppercase separated by colons. e.g. `01:23:45:67:89:AB`

## Status codes

* 202 Accepted - your request has been received and stored for processing
* 400 Bad Request - your request was to a bad resource URL, or the content was invalid (e.g. invalid JSON)
* 404 Not Found - your resource structure is valid but does not exist (e.g. unknown MAC address)

Todo:

* 405 Method Not Allowed - e.g. you are trying to GET a resource that only allows POST. See the resource definitions above

# Reports

* [Benchmarks](reports/ab.md)

# Libraries used

* [ExCheck](https://github.com/parroty/excheck) - property based testing
* [Cowboy](https://github.com/ninenines/cowboy) - the de facto HTTP server for Erlang
* [Plug](https://github.com/elixir-lang/plug) - an Elixir library to build web applicationds

# Credits

* [Travis CI](https://docs.travis-ci.com/user/languages/elixir/)
* [Elixir Process Registry blog post](https://m.alphasights.com/process-registry-in-elixir-a-practical-example-4500ee7c0dcc#.mjkawpix8)